<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>net.http.server documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Net</span> <span class="project-version">0.3.3-beta18</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="intro.html"><div class="inner"><span>Overview</span></div></a></li><li class="depth-1 "><a href="echo.html"><div class="inner"><span>An echo server</span></div></a></li><li class="depth-1 "><a href="chat.html"><div class="inner"><span>A chat server</span></div></a></li><li class="depth-1 "><a href="tls.html"><div class="inner"><span>TLS support</span></div></a></li><li class="depth-1 "><a href="http-server.html"><div class="inner"><span>HTTP servers</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></div></li><li class="depth-3 branch"><a href="net.codec.b64.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>b64</span></div></a></li><li class="depth-3"><a href="net.codec.hex.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hex</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>core</span></div></div></li><li class="depth-3 branch"><a href="net.core.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3"><a href="net.core.concurrent.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>concurrent</span></div></a></li><li class="depth-2"><a href="net.http.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-3 branch"><a href="net.http.chunk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chunk</span></div></a></li><li class="depth-3 branch"><a href="net.http.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-3 current"><a href="net.http.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-2 branch"><a href="net.ssl.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-2 branch"><a href="net.tcp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcp</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transform</span></div></div></li><li class="depth-3 branch"><a href="net.transform.aggregator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>aggregator</span></div></a></li><li class="depth-3"><a href="net.transform.split.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>split</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>ty</span></div></div></li><li class="depth-3 branch"><a href="net.ty.bootstrap.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bootstrap</span></div></a></li><li class="depth-3 branch"><a href="net.ty.buffer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>buffer</span></div></a></li><li class="depth-3 branch"><a href="net.ty.channel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>channel</span></div></a></li><li class="depth-3 branch"><a href="net.ty.coerce.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coerce</span></div></a></li><li class="depth-3 branch"><a href="net.ty.future.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>future</span></div></a></li><li class="depth-3"><a href="net.ty.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="net.http.server.html#var-backpressure-fn"><div class="inner"><span>backpressure-fn</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-close-fn"><div class="inner"><span>close-fn</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-default-aggregated-length"><div class="inner"><span>default-aggregated-length</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-default-chunk-size"><div class="inner"><span>default-chunk-size</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-default-executor"><div class="inner"><span>default-executor</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-default-inbuf"><div class="inner"><span>default-inbuf</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-executor.3F"><div class="inner"><span>executor?</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-get-host-port"><div class="inner"><span>get-host-port</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-get-response"><div class="inner"><span>get-response</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-initializer"><div class="inner"><span>initializer</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-netty-handler"><div class="inner"><span>netty-handler</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-parse-num"><div class="inner"><span>parse-num</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-request-length"><div class="inner"><span>request-length</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-run-server"><div class="inner"><span>run-server</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-send-100-continue-fn"><div class="inner"><span>send-100-continue-fn</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-set-so-backlog.21"><div class="inner"><span>set-so-backlog!</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-write-chunk"><div class="inner"><span>write-chunk</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-write-raw-response"><div class="inner"><span>write-raw-response</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-write-response"><div class="inner"><span>write-response</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-write-response-listener"><div class="inner"><span>write-response-listener</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">net.http.server</h1><div class="doc"><div class="markdown"><p>Small wrapper around netty for HTTP servers. The objective here is to be mostly compatible with the vast number of available clojure HTTP server implementations.</p>
<p>In particular, we take inspiration from and try to be mostly compatible with <a href="https://github.com/mpenet/jet">jet</a>.</p>
<p>The idea is that it should be feasible to write handlers that behave like synchronous ones.</p>
<p>The main function in this namespace is <code>run-server</code></p></div></div><div class="public anchor" id="var-backpressure-fn"><h3>backpressure-fn</h3><div class="usage"><code>(backpressure-fn ctx)</code></div><div class="doc"><div class="markdown"><p>Stop automatically reading from the body channel when we are signalled for backpressure.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L147">view source</a></div></div><div class="public anchor" id="var-close-fn"><h3>close-fn</h3><div class="usage"><code>(close-fn msg ctx)</code></div><div class="doc"><div class="markdown"><p>A closure over a context that will close it when called.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L155">view source</a></div></div><div class="public anchor" id="var-default-aggregated-length"><h3>default-aggregated-length</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L73">view source</a></div></div><div class="public anchor" id="var-default-chunk-size"><h3>default-chunk-size</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L71">view source</a></div></div><div class="public anchor" id="var-default-executor"><h3>default-executor</h3><div class="usage"><code>(default-executor)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L236">view source</a></div></div><div class="public anchor" id="var-default-inbuf"><h3>default-inbuf</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L72">view source</a></div></div><div class="public anchor" id="var-executor.3F"><h3>executor?</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L315">view source</a></div></div><div class="public anchor" id="var-get-host-port"><h3>get-host-port</h3><div class="usage"><code>(get-host-port {:keys [host port]})</code></div><div class="doc"><div class="markdown"><p>Extract host and port from a server options map, providing defaults</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L231">view source</a></div></div><div class="public anchor" id="var-get-response"><h3>get-response</h3><div class="usage"><code>(get-response {:keys [request version]} handler ctx executor)</code></div><div class="doc"><div class="markdown"><p>When an aggregated request is done buffereing, Execute the handler on it and publish the response.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L130">view source</a></div></div><div class="public anchor" id="var-initializer"><h3>initializer</h3><div class="usage"><code>(initializer {:keys [chunk-size ring-handler], :or {chunk-size default-chunk-size}, :as opts})</code></div><div class="doc"><div class="markdown"><p>An initializer is a per-connection context creator. For each incoming connections, the HTTP server codec is used, bodies are aggregated up to a certain size and then handed over to the provided handler</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L209">view source</a></div></div><div class="public anchor" id="var-netty-handler"><h3>netty-handler</h3><div class="usage"><code>(netty-handler handler)</code><code>(netty-handler handler {:keys [inbuf aggregate-length executor]})</code></div><div class="doc"><div class="markdown"><p>This is a stateful, per HTTP session adapter which wraps the user supplied function. We can use volatiles for keeping track of state due to the thread-safe nature of handler adapters.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L173">view source</a></div></div><div class="public anchor" id="var-parse-num"><h3>parse-num</h3><div class="usage"><code>(parse-num s)</code></div><div class="doc"><div class="markdown"><p>Parse a long integer, returning nil on failure</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L113">view source</a></div></div><div class="public anchor" id="var-request-length"><h3>request-length</h3><div class="usage"><code>(request-length {:keys [headers], :as req})</code></div><div class="doc"><div class="markdown"><p>Try extracting a request length if available</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L118">view source</a></div></div><div class="public anchor" id="var-run-server"><h3>run-server</h3><div class="usage"><code>(run-server options handler)</code><code>(run-server options)</code></div><div class="doc"><div class="markdown"><p>Create and run an HTTP server handler. HTTP server handlers rely on a handler function which must be provided separately in the 2-arity version or as the <code>:ring-handler</code> key in the options map in the 1-arity version.</p>
<p>Ring handler is a function of one argument, a correctly formed HTTP request of the following form (see <code>::request</code> spec for full form):</p>
<pre><code>{:request-method &lt;method&gt;
 :uri            &lt;uri&gt;
 :version        &lt;version&gt;
 :headers        &lt;headers&gt;
 :get-params     &lt;map&gt;
 :params         &lt;map&gt;
 :body           &lt;buf-or-channel&gt;}
</code></pre>
<p>When body is a channel, it will produce <code>ByteBuf</code> instances of up to the options <code>chunk-size</code> value.</p>
<p>The function should produce either a channel or map as a response. When the response is a channel, a single value will be consumed from it: the response map.</p>
<p>The response map should be of the form (see <code>::response</code> spec for full form):</p>
<pre><code>{:status         &lt;http-status&gt;
 :headers        &lt;headers&gt;
 :body           &lt;buf-or-channel&gt;}
</code></pre>
<p>When body is a channel, values will be consumed from it and sent out until it is closed. Otherwise, the contents will be sent out directly.</p>
<p>The options map is of the following form:</p>
<pre><code>{:loop-thread-count       &lt;threadcount&gt;
 :disable-epoll           &lt;boolean&gt;
 :host                    &lt;host&gt;
 :port                    &lt;port&gt;
 :chunk-size              &lt;chunk-size&gt;
 :inbuf                   &lt;input-channel-buffer&gt;
 :so-backlog              &lt;backlog&gt;
 :aggregate-length        &lt;body-aggregate-max-size&gt;
 :executor                &lt;ExecutorService used to run/generate sync responses&gt;}
</code></pre>
<p><code>run-server</code> returns a function of no args which when called will shut down the server gracefully.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L240">view source</a></div></div><div class="public anchor" id="var-send-100-continue-fn"><h3>send-100-continue-fn</h3><div class="usage"><code>(send-100-continue-fn ctx msg)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L168">view source</a></div></div><div class="public anchor" id="var-set-so-backlog.21"><h3>set-so-backlog!</h3><div class="usage"><code>(set-so-backlog! bootstrap {:keys [so-backlog]})</code></div><div class="doc"><div class="markdown"><p>Adjust Bootstrap socket backlog</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L226">view source</a></div></div><div class="public anchor" id="var-write-chunk"><h3>write-chunk</h3><div class="usage"><code>(write-chunk {:keys [request], :as state} handler ctx msg executor close?)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L162">view source</a></div></div><div class="public anchor" id="var-write-raw-response"><h3>write-raw-response</h3><div class="usage"><code>(write-raw-response ctx executor resp body)</code></div><div class="doc"><div class="markdown"><p>Write an HTTP response out to a Netty Context</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L96">view source</a></div></div><div class="public anchor" id="var-write-response"><h3>write-response</h3><div class="usage"><code>(write-response ctx executor version {:keys [body], :as resp})</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L123">view source</a></div></div><div class="public anchor" id="var-write-response-listener"><h3>write-response-listener</h3><div class="usage"><code>(write-response-listener ctx body executor)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta18/src/net/http/server.clj#L86">view source</a></div></div></div></body></html>